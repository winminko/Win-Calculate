<!DOCTYPE html>
<html lang="my" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>Survey Tools • Win-Calculate</title>
<link rel="manifest" href="manifest.json"><meta name="theme-color" content="#6c5ce7">
<style>
:root{--bg:#f6f7fb;--card:#ffffffee;--text:#0f1115;--muted:#5b616e;--line:#e8e9ef;--accent:#6c5ce7;--ok:#12b886;--danger:#ff6b6b}
[data-theme="dark"]:root{--bg:#0f1115;--card:#171a22ee;--text:#f7f7fb;--muted:#aab0bf;--line:#2a2f3a;--accent:#9b87ff;--ok:#2dd4bf;--danger:#ff8c8c}
html,body{margin:0;height:100%;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,"Noto Sans Myanmar",sans-serif}
.appbar{position:fixed;inset:0 0 auto 0;height:58px;display:flex;gap:10px;align-items:center;padding:0 14px;background:linear-gradient(180deg,rgba(255,255,255,.75),rgba(255,255,255,.55));border-bottom:1px solid var(--line);backdrop-filter:blur(10px);z-index:9999}
[data-theme="dark"] .appbar{background:linear-gradient(180deg,rgba(23,26,34,.75),rgba(23,26,34,.55))}
.title{font-weight:900}
.toggle{margin-left:auto;border:1px solid var(--line);background:var(--card);border-radius:999px;padding:6px 10px;font-weight:800}
.tabs{position:fixed;top:60px;left:12px;right:12px;display:flex;gap:8px;z-index:9999}
.tab{padding:8px 12px;border-radius:12px;border:1px solid var(--line);background:var(--card);font-weight:800;cursor:pointer}
.tab.active{background:var(--accent);color:#fff;border-color:transparent}
#stage{position:fixed;inset:0;z-index:1}
.section{display:none}.section.show{display:block}
.panel{position:fixed;left:12px;right:12px;bottom:12px;padding:12px;border:1px solid var(--line);border-radius:16px;background:var(--card);box-shadow:0 10px 30px rgba(0,0,0,.18);z-index:9000}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
label{font-size:13px;color:var(--muted)}
input[type=number],input[type=text]{width:110px;padding:8px 10px;border:1px solid var(--line);border-radius:12px;background:transparent;color:var(--text)}
.btn{padding:8px 12px;border-radius:12px;border:1px solid var(--line);background:var(--card);font-weight:800;cursor:pointer}
.btn.ok{background:var(--ok);color:#00130f;border:0}.btn.danger{background:var(--danger);color:#fff;border:0}
.info{font-size:13px;white-space:pre-wrap;margin-top:6px}
.mini{width:100%;max-width:360px;height:auto;border:1px dashed var(--line);border-radius:12px;padding:8px}
table{width:100%;border-collapse:collapse}th,td{padding:6px 8px;border-bottom:1px solid var(--line);text-align:left}th{background:rgba(0,0,0,.04)}
.axis{padding:2px 6px;border-radius:999px;background:#000;color:#fff;font-size:11px}
.lbl{padding:3px 6px;border-radius:8px;background:rgba(255,255,255,.85);border:1px solid rgba(0,0,0,.12);font-size:12px;font-weight:800;color:#111}
[data-theme="dark"] .lbl{background:rgba(23,26,34,.9);color:#fff;border-color:#000}
                                                                                                                                                   </style>
                                                                                                                                                   </head>
<body>
  <div class="appbar">
    <div class="title">Created By Mr.WIN MIN KO</div>
    <button id="theme" class="toggle">🌙</button>
  </div>

  <div class="tabs">
    <button class="tab active" onclick="switchTab('sec-points',this)">1) Points 3D / 2D(EN)</button>
    <button class="tab" onclick="switchTab('sec-circle',this)">2) Circle Center</button>
    <button class="tab" onclick="switchTab('sec-right',this)">3) Right Triangle</button>
  </div>

  <div id="stage"></div>

  <!-- Points -->
  <div id="sec-points" class="section show">
    <div class="panel">
      <h3>Points • tap=select • 2-fingers zoom/pan/rotate</h3>
      <div class="row" style="margin-bottom:6px">
        <label>Hinput: <input id="Hin" type="number" step="0.1" value="0.00"></label>
        <label>E: <input id="eIn" type="number" step="0.1"></label>
        <label>N: <input id="nIn" type="number" step="0.1"></label>
        <label>H: <input id="hIn" type="number" step="0.1"></label>
        <button id="add" class="btn ok">Add Point</button>
        <button id="clearAll" class="btn danger">Clear All</button>
        <button id="reset" class="btn">Reset View</button>
        <button id="imgPts" class="btn">Save Image (PNG)</button>
        <label style="margin-left:auto"><input id="mode2d" type="checkbox"> 2D EN mode</label>
      </div>
      <div id="out" class="info">Hinput = 0.000\nNo points yet. Enter E,N,H and tap "Add Point".</div>
      <div id="items" style="margin-top:8px"></div>
    </div>
  </div>

  <!-- Circle Center -->
  <div id="sec-circle" class="section">
    <div class="panel">
      <h3>Circle Center (E,N) — Adjusted vs Best-Fit</h3>
      <div class="row" style="margin-bottom:6px">
        <label><b>Rows</b> <input id="count" type="number" min="3" max="500" value="4"></label>
        <button class="btn" id="applyCount">Apply</button>
        <div style="margin-left:auto">Decimals: <input id="decimals" type="number" min="0" max="10" value="3" style="width:70px"></div>
        <button class="btn ok" id="computeBtn">Compute</button>
      </div>
      <div class="mini">
        <table>
          <thead><tr><th style="width:48px">#</th><th>Point</th><th>E</th><th>N</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
        <div class="row" style="margin-top:6px">
          <button class="btn" id="addRow">+ Add row</button>
          <button class="btn" id="removeRow">– Remove row</button>
        </div>
      </div>
      <div id="results" style="display:none;margin-top:10px">
        <div><b id="centerOut">Adjusted Center: —</b></div>
        <div><b id="bfcOut">Best-Fit Center: —</b></div>
        <div id="circleExtra" style="margin-top:6px"></div>
        <table style="margin-top:8px">
          <thead><tr><th>Point</th><th>Radius (to ref center)</th></tr></thead>
          <tbody id="radiiBody"></tbody>
        </table>
        <canvas id="canvas" width="600" height="400"></canvas>
      </div>
    </div>
  </div>

  <!-- Right Triangle -->
  <div id="sec-right" class="section">
    <div class="panel">
      <h3>Right Triangle</h3>
      <div class="row" style="margin-bottom:6px">
        <label>a (leg): <input id="ra" type="number" step="0.1"></label>
        <label>b (leg): <input id="rb" type="number" step="0.1"></label>
        <label>Angle A (°): <input id="rA" type="number" step="0.1"></label>
        <label>Angle B (°): <input id="rB" type="number" step="0.1"></label>
        <button id="rightSolve" class="btn ok">Solve</button>
        <button id="rightClear" class="btn">Clear</button>
      </div>
      <div class="mini" id="rightFig"></div>
      <div id="rightOut" class="info"></div>
    </div>
          </div>
          <!-- libs (classic) -->
  <script src="https://unpkg.com/three@0.158.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.158.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://unpkg.com/three@0.158.0/examples/js/renderers/CSS2DRenderer.js"></script>

  <script>
  // ---------- Tabs ----------
  window.switchTab=function(id,btn){
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    if(btn) btn.classList.add('active');
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('show'));
    const sec=document.getElementById(id); if(sec) sec.classList.add('show');
  };

  // ---------- Theme ----------
  document.getElementById('theme').onclick=function(){
    const root=document.documentElement,now=root.getAttribute('data-theme');
    root.setAttribute('data-theme',now==='dark'?'light':'dark');
    this.textContent=(now==='dark')?'🌙':'☀️';
    scene.background=new THREE.Color(getComputedStyle(root).getPropertyValue('--bg').trim()||'#fff');
  };

  // ---------- 3D / 2D Points ----------
  const stage=document.getElementById('stage');
  const scene=new THREE.Scene();
  scene.background=new THREE.Color(getComputedStyle(document.documentElement).getPropertyValue('--bg').trim()||'#fff');
  const camera=new THREE.PerspectiveCamera(55,innerWidth/innerHeight,0.1,2000); camera.position.set(8,6,8);
  const renderer=new THREE.WebGLRenderer({antialias:true}); renderer.setSize(innerWidth,innerHeight); stage.appendChild(renderer.domElement);
  const labelRenderer=new THREE.CSS2DRenderer(); labelRenderer.setSize(innerWidth,innerHeight);
  labelRenderer.domElement.style.position='fixed'; labelRenderer.domElement.style.inset='0'; labelRenderer.domElement.style.pointerEvents='none';
  stage.appendChild(labelRenderer.domElement);
  const controls=new THREE.OrbitControls(camera,renderer.domElement); controls.enableDamping=true;
  scene.add(new THREE.AmbientLight(0xffffff,.9)); const dl=new THREE.DirectionalLight(0xffffff,.45); dl.position.set(3,5,4); scene.add(dl);
  scene.add(new THREE.GridHelper(200,200,0x999999,0xdddddd)); scene.add(new THREE.AxesHelper(6));
  const ax=(t,p)=>{const d=document.createElement('div');d.className='axis';d.textContent=t;const o=new THREE.CSS2DObject(d);o.position.copy(p);scene.add(o)};
  ax('E',new THREE.Vector3(6.8,0,0)); ax('N',new THREE.Vector3(0,6.8,0)); ax('H',new THREE.Vector3(0,0,6.8));

  const P=[],ptGeo=new THREE.SphereGeometry(0.11,24,24),ptMat=new THREE.MeshStandardMaterial({color:0x111111,metalness:.1,roughness:.5});
  let counter=0,selA=null,selB=null; const link=new THREE.Group(); scene.add(link);
  function lbl(t){const el=document.createElement('div');el.className='lbl';el.textContent=t;return new THREE.CSS2DObject(el);}
  function addPoint(E,N,H,n){const id=n||`P${++counter}`,m=new THREE.Mesh(ptGeo,ptMat); m.position.set(E,N,H); m.add(lbl(id)); scene.add(m);
    const rec={id,mesh:m,pos:m.position}; P.push(rec); list(); info(); return rec;}
  function removeAt(i){const r=P[i]; if(!r) return; scene.remove(r.mesh); r.mesh.geometry.dispose(); P.splice(i,1); list(); if(selA===r||selB===r){selA=null;selB=null;link.clear();} info();}
  function glow(r,on){r.mesh.scale.setScalar(on?1.28:1.0);}
  function drawLine(){link.clear(); if(!(selA&&selB)) return; const g=new THREE.BufferGeometry().setFromPoints([selA.pos.clone(),selB.pos.clone()]); link.add(new THREE.Line(g,new THREE.LineBasicMaterial({color:0x2b2b2b})));}

  // select by nearest screen-pixel
  function nearest(cx,cy){let best=null,dmin=28; P.forEach(r=>{const v=r.pos.clone().project(camera),sx=(v.x*0.5+0.5)*innerWidth,sy=(-v.y*0.5+0.5)*innerHeight,d=Math.hypot(sx-cx,sy-cy); if(d<dmin){dmin=d;best=r;}}); return best;}
  renderer.domElement.addEventListener('pointerup',e=>{const r=renderer.domElement.getBoundingClientRect(),cx=e.clientX-r.left,cy=e.clientY-r.top,hit=nearest(cx,cy);
    if(hit){ if(!selA){selA=hit;glow(selA,true);} else if(!selB && hit!==selA){selB=hit;glow(selB,true);drawLine();} else {glow(selA,false);glow(selB,false);selA=hit;selB=null;link.clear();glow(selA,true);} info(); }});

  // UI hooks
  const R=v=>Number.isFinite(v)?(+v).toFixed(3):v;
  document.getElementById('add').onclick=()=>addPoint(+(eIn.value||0),+(nIn.value||0),+(hIn.value||0));
  document.getElementById('clearAll').onclick=()=>{while(P.length) removeAt(P.length-1); counter=0;};
  document.getElementById('reset').onclick=()=>{camera.position.set(8,6,8); controls.target.set(0,0,0); controls.update();};
  document.getElementById('mode2d').onchange=info;

  const items=document.getElementById('items');
  function list(){items.innerHTML=''; P.forEach((r,i)=>{const row=document.createElement('div'); row.style.cssText='display:flex;justify-content:space-between;gap:6px;padding:6px 0;border-bottom:1px solid var(--line)';
    row.innerHTML=`<div style="font-size:12.5px">${r.id}: (${R(r.pos.x)}, ${R(r.pos.y)}, ${R(r.pos.z)})</div>`;
    const box=document.createElement('div'),s=document.createElement('button'),d=document.createElement('button');
    s.className='btn'; s.textContent='Select'; s.onclick=()=>{selA=r;selB=null;link.clear();glow(r,true);info();};
    d.className='btn danger'; d.textContent='Del'; d.onclick=()=>removeAt(i); box.appendChild(s); box.appendChild(d); row.appendChild(box); items.appendChild(row); });}

  function info(){
    const Hin=+document.getElementById('Hin').value||0; let t=`Hinput = ${R(Hin)}\n`;
    if(P.length===0){document.getElementById('out').textContent=t+'No points yet. Enter E,N,H and tap "Add Point".';return;}
    if(selA){t+=`Selected: ${selA.id}${selB?' → '+selB.id:''}\n`;} else t+='Selected: (choose any 2 points)\n';
    if(selA&&selB){const A=selA.pos,B=selB.pos,dE=B.x-A.x,dN=B.y-A.y,dH=B.z-A.z,dEN=Math.hypot(dE,dN),d3=Math.hypot(dEN,dH); let plan=Math.atan2(dN,dE)*180/Math.PI; if(plan<0) plan+=360; const elev=Math.atan2(dH,dEN)*180/Math.PI;
      t+=`ΔE=${R(dE)}, ΔN=${R(dN)}, ΔH=${R(dH)}\nPlan dEN=${R(dEN)} | 3D=${R(d3)}\nPlan angle=${R(plan)}° | Elevation=${R(elev)}°`;
      if(document.getElementById('mode2d').checked){t+=`\n\n[2D EN Mode] dEN=${R(dEN)} | Bearing=${R(plan)}°`;}
    }
    document.getElementById('out').textContent=t;
  }

  // render/resize
  (function loop(){controls.update();renderer.render(scene,camera);labelRenderer.render(scene,camera);requestAnimationFrame(loop);})();
  addEventListener('resize',()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);labelRenderer.setSize(innerWidth,innerHeight);});

  // ---------- Save PNG (2D/3D stage only) ----------
  document.getElementById('imgPts').addEventListener('click',async()=>{
    await loadCDN('https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js');
    const bg=getComputedStyle(document.documentElement).getPropertyValue('--bg').trim()||'#fff';
    const cvs=await html2canvas(document.getElementById('stage'),{scale:2,useCORS:true,backgroundColor:bg});
    const url=cvs.toDataURL('image/png'); const a=document.createElement('a'); a.href=url; a.download=(document.getElementById('mode2d').checked?'points-2D.png':'points-3D.png'); a.click();
  });
  function loadCDN(src){return new Promise((res,rej)=>{if(document.querySelector(`script[src="${src}"]`)) return res(); const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=rej; document.head.appendChild(s);});}

  // ---------- Circle Center (Adjusted + Best-Fit) ----------
  const fmt=(v,d=3)=>Number(v).toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d});
  function centerFrom3(A,B,C){const x1=A.E,y1=A.N,x2=B.E,y2=B.N,x3=C.E,y3=C.N,a1=x1-x2,b1=y1-y2,a2=x1-x3,b2=y1-y3,e=((x1*x1-x2*x2)+(y1*y1-y2*y2))/2,f=((x1*x1-x3*x3)+(y1*y1-y3*y3))/2,det=a1*b2-b1*a2; if(Math.abs(det)<1e-12)return null; return {E:(e*b2-b1*f)/det,N:(a1*f-e*a2)/det};}
  const distEN=(c,p)=>Math.hypot(c.E-p.E,c.N-p.N);
  function computeAdjustedCenter(pts){const n=pts.length;if(n<3)throw Error("Need at least 3 points.");let se=0,sn=0,k=0;for(let i=0;i<n-2;i++)for(let j=i+1;j<n-1;j++)for(let m=j+1;m<n;m++){const c=centerFrom3(pts[i],pts[j],pts[m]);if(c){se+=c.E;sn+=c.N;k++;}}if(k===0)throw Error("No valid centers");return {E:se/k,N:sn/k,validTriples:k};}
  function bestFitCircle(pts){const n=pts.length;if(n<3)throw Error("Need at least 3 points.");let Sx=0,Sy=0,Sxx=0,Syy=0,Sxy=0,S1=n,Tx=0,Ty=0,T1=0;for(const p of pts){const x=p.E,y=p.N,t=-(x*x+y*y);Sx+=x;Sy+=y;Sxx+=x*x;Syy+=y*y;Sxy+=x*y;Tx+=x*t;Ty+=y*t;T1+=t;}const M=[[Sxx,Sxy,Sx],[Sxy,Syy,Sy],[Sx,Sy,S1]],b=[Tx,Ty,T1],inv=inv3(M);if(!inv)throw Error("Best-fit failed.");const a=dot(inv[0],b),bb=dot(inv[1],b),c=dot(inv[2],b);return {E:-a/2,N:-bb/2,r:Math.sqrt(Math.max(0,(a*a+bb*bb)/4-c))};}
  const dot=(r,b)=>r[0]*b[0]+r[1]*b[1]+r[2]*b[2];
  function inv3(M){const d=M[0][0]*(M[1][1]*M[2][2]-M[1][2]*M[2][1])-M[0][1]*(M[1][0]*M[2][2]-M[1][2]*M[2][0])+M[0][2]*(M[1][0]*M[2][1]-M[1][1]*M[2][0]);if(Math.abs(d)<1e-12)return null;return[
    [(M[1][1]*M[2][2]-M[1][2]*M[2][1])/d,(M[0][2]*M[2][1]-M[0][1]*M[2][2])/d,(M[0][1]*M[1][2]-M[0][2]*M[1][1])/d],
    [(M[1][2]*M[2][0]-M[1][0]*M[2][2])/d,(M[0][0]*M[2][2]-M[0][2]*M[2][0])/d,(M[0][2]*M[1][0]-M[0][0]*M[1][2])/d],
    [(M[1][0]*M[2][1]-M[1][1]*M[2][0])/d,(M[0][1]*M[2][0]-M[0][0]*M[2][1])/d,(M[0][0]*M[1][1]-M[0][1]*M[1][0])/d]
  ];}
  const tbody=document.getElementById('tbody'); function makeRow(i){const tr=document.createElement('tr'); tr.innerHTML=`<td>${i+1}</td><td><input type="text" placeholder="P${i+1}"></td><td><input type="number" step="any"></td><td><input type="number" step="any"></td>`; return tr;}
  function rebuildRows(n){tbody.innerHTML=''; for(let i=0;i<n;i++) tbody.appendChild(makeRow(i));} rebuildRows(4);
  function getRows(){return [...tbody.querySelectorAll('tr')].map((tr,i)=>{const [n,e,f]=tr.querySelectorAll('input'); return {name:n.value.trim()||`P${i+1}`,E:Number(e.value),N:Number(f.value)};});}
  document.getElementById('applyCount').onclick=()=>rebuildRows(Number(document.getElementById('count').value)||4);
  document.getElementById('addRow').onclick=()=>tbody.appendChild(makeRow(tbody.children.length));
  document.getElementById('removeRow').onclick=()=>{if(tbody.children.length>0)tbody.removeChild(tbody.lastElementChild);};
  document.getElementById('computeBtn').onclick=()=>{const d=Math.max(0,Math.min(10,Number(document.getElementById('decimals').value)||0)),rows=getRows(),pts=[],names=[]; rows.forEach((r,i)=>{if(!Number.isFinite(r.E)||!Number.isFinite(r.N))throw Error(`Row ${i+1}: need E & N`); pts.push({E:r.E,N:r.N}); names.push(r.name);});
    let adj=null,bfc=null; try{adj=computeAdjustedCenter(pts);}catch{} try{bfc=bestFitCircle(pts);}catch{} const ref=adj?{E:adj.E,N:adj.N}:bfc?{E:bfc.E,N:bfc.N}:null;
    const radii=ref?pts.map((p,i)=>({name:names[i],radius:distEN(ref,p)})):[];
    document.getElementById('centerOut').textContent=adj?`Adjusted Center: E=${fmt(adj.E,d)}, N=${fmt(adj.N,d)} (triples=${adj.validTriples})`:'Adjusted Center: —';
    document.getElementById('bfcOut').textContent=bfc?`Best-Fit Center: E=${fmt(bfc.E,d)}, N=${fmt(bfc.N,d)}, r=${fmt(bfc.r,d)}`:'Best-Fit Center: —';
    let circ='',area=''; if(bfc){circ=`2πr=${fmt(2*Math.PI*bfc.r,d)}`;area=`πr²=${fmt(Math.PI*bfc.r*bfc.r,d)}`;} else if(radii.length){const r=radii.reduce((s,x)=>s+x.radius,0)/radii.length; circ=`≈2πr=${fmt(2*Math.PI*r,d)}`; area=`≈πr²=${fmt(Math.PI*r*r,d)}`;} document.getElementById('circleExtra').innerHTML=(circ?`${circ} | ${area}`:'');
    const cvs=document.getElementById('canvas'),ctx=cvs.getContext('2d'); ctx.clearRect(0,0,cvs.width,cvs.height); const Es=pts.map(p=>p.E),Ns=pts.map(p=>p.N),allE=[...Es],allN=[...Ns]; if(adj){allE.push(adj.E);allN.push(adj.N);} if(bfc){allE.push(bfc.E);allN.push(bfc.N);}
    const minE=Math.min(...allE),maxE=Math.max(...allE),minN=Math.min(...allN),maxN=Math.max(...allN),pad=40,scale=Math.min((cvs.width-2*pad)/(maxE-minE||1),(cvs.height-2*pad)/(maxN-minN||1));
    const x=E=>pad+(E-minE)*scale, y=N=>cvs.height-(pad+(N-minN)*scale);
    ctx.fillStyle="blue"; pts.forEach((p,i)=>{ctx.beginPath();ctx.arc(x(p.E),y(p.N),5,0,2*Math.PI);ctx.fill();ctx.fillText(names[i],x(p.E)+6,y(p.N)-6);});
    if(adj){ctx.beginPath();ctx.arc(x(adj.E),y(adj.N),6,0,2*Math.PI);ctx.fillStyle="#e11";ctx.fill();ctx.fillText("Adj",x(adj.E)+8,y(adj.N)); const avg=radii.length?radii.reduce((s,r)=>s+r.radius,0)/radii.length:0; if(avg>0){ctx.strokeStyle="#22a255";ctx.lineWidth=1.5;ctx.beginPath();ctx.arc(x(adj.E),y(adj.N),avg*scale,0,2*Math.PI);ctx.stroke();}}
    if(bfc){ctx.beginPath();ctx.arc(x(bfc.E),y(bfc.N),6,0,2*Math.PI);ctx.fillStyle="#06f";ctx.fill();ctx.fillText("Best",x(bfc.E)+8,y(bfc.N)); ctx.strokeStyle="#0a6cff";ctx.setLineDash([6,4]);ctx.beginPath();ctx.arc(x(bfc.E),y(bfc.N),bfc.r*scale,0,2*Math.PI);ctx.stroke();ctx.setLineDash([]);}
    document.getElementById('results').style.display='block';
  });

  // ---------- Right Triangle ----------
  const rA=document.getElementById('rA'),rB=document.getElementById('rB'),ra=document.getElementById('ra'),rb=document.getElementById('rb');
  document.getElementById('rightSolve').onclick=solveRight;
  document.getElementById('rightClear').onclick=()=>{[rA,rB,ra,rb].forEach(x=>x.value='');document.getElementById('rightOut').textContent='';document.getElementById('rightFig').innerHTML='';};
  function n(v){const x=parseFloat(v);return Number.isFinite(x)?x:NaN;} const f=x=>Number.isFinite(x); const d2r=d=>d*Math.PI/180, r2d=r=>r*180/Math.PI;
  function solveRight(){const A=n(rA.value),B=n(rB.value),a=n(ra.value),b=n(rb.value);
    if(f(a)&&f(b)){const c=Math.hypot(a,b),Ad=r2d(Math.atan2(a,b)),Bd=90-Ad; out(a,b,c,Ad,Bd); return;}
    if(f(a)&&f(A)){const Ar=d2r(A),b2=a/Math.tan(Ar),c=a/Math.sin(Ar); out(a,b2,c,A,90-A); return;}
    if(f(b)&&f(B)){const Br=d2r(B),a2=b*Math.tan(Br),c=b/Math.cos(Br); out(a2,b,c,90-B,B); return;}
    document.getElementById('rightOut').textContent='Fill (a & b) or (a & A) or (b & B).';
  }
  function out(a,b,c,A,B){document.getElementById('rightOut').textContent=`a=${a.toFixed(3)}, b=${b.toFixed(3)}, c=${c.toFixed(3)}\nA=${A.toFixed(3)}°, B=${B.toFixed(3)}°, (C=90°)`;
    const W=340,H=140,p=18,k=(Math.min(W,H)-2*p)/Math.max(a,b,1),Ax=p,Ay=H-p,Bx=p+b*k,By=H-p,Cx=p+b*k,Cy=H-p-a*k,r=16;
    const sAx=Ax+r,sAy=Ay,vACx=Cx-Ax,vACy=Cy-Ay,LAC=Math.hypot(vACx,vACy)||1,uACx=vACx/LAC,uACy=vACy/LAC,eAx=Ax+uACx*r,eAy=Ay+uACy*r;
    const sBx=Cx,sBy=Cy+r,vCAx=Ax-Cx,vCAy=Ay-Cy,LCA=Math.hypot(vCAx,vCAy)||1,uCAx=vCAx/LCA,uCAy=vCAy/LCA,eBx=Cx+uCAx*r,eBy=Cy+uCAy*r;
    document.getElementById('rightFig').innerHTML=`<svg width="${W}" height="${H}" viewBox="0 0 ${W} ${H}">
      <polyline points="${Ax},${Ay} ${Bx},${By} ${Cx},${Cy} ${Ax},${Ay}" fill="none" stroke="currentColor" stroke-width="2"/>
      <rect x="${Bx-10}" y="${By-10}" width="10" height="10" fill="none" stroke="currentColor" stroke-width="2"/>
      <text x="${(Ax+Bx)/2}" y="${Ay-6}" font-size="12" text-anchor="middle">b</text>
      <text x="${Bx+6}" y="${(By+Cy)/2}" font-size="12">a</text>
      <text x="${(Ax+Cx)/2}" y="${(Ay+Cy)/2-8}" font-size="12" text-anchor="middle">c</text>
      <path d="M ${sAx} ${sAy} A ${r} ${r} 0 0 1 ${eAx} ${eAy}" fill="none" stroke="currentColor" stroke-width="1.5"/>
      <path d="M ${sBx} ${sBy} A ${r} ${r} 0 0 1 ${eBx} ${eBy}" fill="none" stroke="currentColor" stroke-width="1.5"/>
      <text x="${Ax+(eAx-Ax)*0.6}" y="${Ay+(eAy-Ay)*0.6-4}" font-size="12">A</text>
      <text x="${Cx+(eBx-Cx)*0.6+4}" y="${Cy+(eBy-Cy)*0.6}" font-size="12">B</text>
    </svg>`;
  }

  // PWA SW (optional)
  if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}
  </script>
</body>
</html>
